generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[]
}

model User {
  id                      Int                      @id @default(autoincrement())
  fullName                String?
  username                String?                  @unique
  email                   String                   @unique
  password                String
  address                 String?
  dateOfBirth             DateTime?
  age                     Int?
  roleId                  Int                      @default(1)
  role                    Role                     @relation(fields: [roleId], references: [id])
  schoolId                Int?
  school                  School?                  @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  emailVerified           Boolean                  @default(false)
  emailVerificationTokens EmailVerificationToken[]
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  magicLoginTokens        magicLoginToken[]
}

model EmailVerificationToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  expiresAt DateTime
  userId    Int
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum EducationLevel {
  PRIMARY_SCHOOL
  JUNIOR_HIGH_SCHOOL
  SENIOR_HIGH_SCHOOL
}

model School {
  id             Int            @id @default(autoincrement())
  name           String
  slug           String
  address        String
  user           User[]
  educationLevel EducationLevel
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model magicLoginToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  expiresAt DateTime
  userId    Int
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId])
  @@index([userId])
}
